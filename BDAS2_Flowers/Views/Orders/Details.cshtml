@model BDAS2_Flowers.Models.ViewModels.OrderDetailsVm
@using System.Globalization
@{
    ViewData["Title"] = "Detail objednávky";
    var cz = new CultureInfo("cs-CZ");
    string masked = !string.IsNullOrWhiteSpace(Model.PaymentMasked)
        ? Model.PaymentMasked
        : (Model.CardLast4.HasValue ? $"**** **** **** {Model.CardLast4.Value:D4}" : "");
}

<h1 class="h3">Objednávka @Model.PublicNo</h1>

<div class="row g-3 mb-3">
    <div class="col-md-3"><strong>Datum:</strong> @Model.OrderDate.ToString("dd.MM.yyyy HH:mm")</div>
    <div class="col-md-3"><strong>Zákazník:</strong> @Model.Customer</div>
    <div class="col-md-3"><strong>Status:</strong> <span class="badge bg-secondary">@Model.Status</span></div>
    <div class="col-md-3"><strong>Doručení:</strong> @Model.Delivery</div>
    <div class="col-md-3"><strong>Prodejna:</strong> @Model.Shop</div>
</div>

@if (!string.IsNullOrWhiteSpace(Model.PaymentType))
{
    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title mb-3">Platba</h5>

            <div class="row g-2">
                <div class="col-md-3">
                    <div><strong>Typ platby:</strong></div>
                    <div>
                        @switch (Model.PaymentType?.ToLowerInvariant())
                        {
                            case "card":
                                @:<span class="badge bg-primary">Kartou</span>
                                break;
                            case "cash":
                                @:<span class="badge bg-success">Hotově</span>
                                break;
                            case "cupon":
                                @:<span class="badge bg-info text-dark">Kupon</span>
                                break;
                            default:
                                @:<span class="badge bg-light text-dark">@Model.PaymentType</span>
                                break;
                        }
                    </div>
                </div>

                @* karta *@
                @if (Model.PaymentType?.ToLowerInvariant() == "card" && !string.IsNullOrWhiteSpace(masked))
                {
                    <div class="col-md-3">
                        <div><strong>Karta:</strong></div>
                        <div>@masked</div>
                    </div>
                }

                @* наличные *@
                @if (Model.PaymentType?.ToLowerInvariant() == "cash")
                {
                    <div class="col-md-3">
                        <div><strong>Přijato:</strong></div>
                        <div>@(Model.CashAccepted?.ToString("N2", cz)) Kč</div>
                    </div>
                    <div class="col-md-3">
                        <div><strong>Vráceno:</strong></div>
                        <div>@(Model.CashReturned?.ToString("N2", cz)) Kč</div>
                    </div>
                }

                @* купон (если есть) *@
                @if (Model.PaymentType?.ToLowerInvariant() == "cupon")
                {
                    <div class="col-md-3">
                        <div><strong>Bonus kuponu:</strong></div>
                        <div>@(Model.CuponBonus?.ToString("N2", cz)) Kč</div>
                    </div>
                    <div class="col-md-3">
                        <div><strong>Platnost do:</strong></div>
                        <div>@(Model.CuponExpiry?.ToString("dd.MM.yyyy"))</div>
                    </div>
                }
            </div>
        </div>
    </div>
}

<div class="table-responsive mb-3">
    <table class="table align-middle">
        <thead>
            <tr>
                <th>Produkt</th>
                <th class="text-center">Množství</th>
                <th class="text-end">Cena/ks</th>
                <th class="text-end">Řádek</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var it in Model.Items)
            {
                <tr>
                    <td>@it.ProductName</td>
                    <td class="text-center">@it.Quantity</td>
                    <td class="text-end">@it.UnitPrice.ToString("N2", cz) Kč</td>
                    <td class="text-end">@it.LineTotal.ToString("N2", cz) Kč</td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-end">Celkem</th>
                <th class="text-end">@Model.Total.ToString("N2", cz) Kč</th>
            </tr>
        </tfoot>
    </table>
</div>

<a class="btn btn-light" href="/">Zpět do katalogu</a>
